string sayHelloToFriends(
    string userId,
    int? numberOfFriends){
  UserInfo userInfo = getUserInfo(userId = userId)
  UserInfo*? friendsInfos = getUserInfoFromUserService(
    userId =* {
      return IntStream.range(0, numberOfFriends or 2)
         .mapToObj(i, getFriendId(i))
         .toSet();
    }
  )
  {
    return "Hello Friends of %s ! %s"
        .formatted(
          userInfo.name(),
          friendInfos.responses()
            .filterPresent()
            .map(_.userName())
            .collect(joining(", "))
        );
  }
}