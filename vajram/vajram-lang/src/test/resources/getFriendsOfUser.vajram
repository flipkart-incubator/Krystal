package com.flipkart.krystal.vajram.lang.samples.friends;

import java.lang.Set;
import com.flipkart.krystal.vajram.lang.samples.friendsservice.FriendServiceClient;

public Set<string> getFriendsOfUser(
    @mod @input string userId,
    @inject FriendServiceClient svcClient){

  @output ~{
    svcClient.getFriendsIds(
        FriendServiceClient.makeFriendIdsRequest(
            #mod().stream()
                .map(_.userId)
                .toSet()))
      ~then {
          Set<string>? nullbleFriendIds = _!throwError();
          Set<string> friendIds = nullbleFriendIds?or(Set.of());
          friendIds
              .stream()
              .toMap {
                new #mod(_.userId()), _.friendIds()
              }
      }
  }
}